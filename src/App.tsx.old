import React, { useState } from 'react';
import { Dashboard } from './components/Dashboard';
import { SubscriptionDetails } from './components/SubscriptionDetails';
import { SavingsMandir } from './components/SavingsMandir';
import { AddSubscription } from './components/AddSubscription';
import { Insights } from './components/Insights';
import { Settings } from './components/Settings';
import { Navigation } from './components/Navigation';
import { Login } from './components/auth/Login';
import { Signup } from './components/auth/Signup';
import { ForgotPassword } from './components/auth/ForgotPassword';
import { OTPVerification } from './components/auth/OTPVerification';
import { ResetPassword } from './components/auth/ResetPassword';
import { Onboarding } from './components/Onboarding';
import { PaymentMethods } from './components/PaymentMethods';
import { Notifications } from './components/Notifications';
import { Profile } from './components/Profile';
import { Help } from './components/Help';

export default function App() {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [showOnboarding, setShowOnboarding] = useState(false);
  const [authScreen, setAuthScreen] = useState<'login' | 'signup' | 'forgot' | 'otp' | 'reset'>('login');
  const [resetData, setResetData] = useState({ emailOrPhone: '', method: 'email' as 'email' | 'phone' });
  const [activeScreen, setActiveScreen] = useState('dashboard');
  
  // Handle login
  const handleLogin = (email: string, password: string) => {
    // In a real app, this would validate credentials
    console.log('Login:', email, password);
    setIsAuthenticated(true);
  };

  // Handle signup
  const handleSignup = (name: string, email: string, phone: string, password: string) => {
    // In a real app, this would create a new account
    console.log('Signup:', name, email, phone, password);
    setShowOnboarding(true);
  };

  // Handle forgot password
  const handleForgotPassword = (emailOrPhone: string) => {
    setResetData({ 
      emailOrPhone, 
      method: emailOrPhone.includes('@') ? 'email' : 'phone' 
    });
    setAuthScreen('otp');
  };

  // Handle OTP verification
  const handleOTPVerified = (otp: string) => {
    console.log('OTP verified:', otp);
    setAuthScreen('reset');
  };

  // Handle password reset
  const handlePasswordReset = (newPassword: string) => {
    console.log('Password reset:', newPassword);
    setAuthScreen('login');
  };

  // Handle onboarding complete
  const handleOnboardingComplete = () => {
    setShowOnboarding(false);
    setIsAuthenticated(true);
  };

  // Handle logout
  const handleLogout = () => {
    setIsAuthenticated(false);
    setActiveScreen('dashboard');
  };

  // Show onboarding if needed
  if (showOnboarding) {
    return <Onboarding onComplete={handleOnboardingComplete} />;
  }

  // Show auth screens if not authenticated
  if (!isAuthenticated) {
    switch (authScreen) {
      case 'login':
        return (
          <Login
            onLogin={handleLogin}
            onSwitchToSignup={() => setAuthScreen('signup')}
            onForgotPassword={() => setAuthScreen('forgot')}
          />
        );
      case 'signup':
        return (
          <Signup
            onSignup={handleSignup}
            onSwitchToLogin={() => setAuthScreen('login')}
          />
        );
      case 'forgot':
        return (
          <ForgotPassword
            onBack={() => setAuthScreen('login')}
            onResetRequested={handleForgotPassword}
          />
        );
      case 'otp':
        return (
          <OTPVerification
            onBack={() => setAuthScreen('forgot')}
            onVerified={handleOTPVerified}
            emailOrPhone={resetData.emailOrPhone}
            method={resetData.method}
          />
        );
      case 'reset':
        return <ResetPassword onPasswordReset={handlePasswordReset} />;
      default:
        return (
          <Login
            onLogin={handleLogin}
            onSwitchToSignup={() => setAuthScreen('signup')}
            onForgotPassword={() => setAuthScreen('forgot')}
          />
        );
    }
  }
  
  const renderScreen = () => {
    switch (activeScreen) {
      case 'dashboard':
        return <Dashboard onNavigate={setActiveScreen} />;
      case 'details':
        return <SubscriptionDetails onBack={() => setActiveScreen('dashboard')} />;
      case 'mandir':
        return <SavingsMandir onBack={() => setActiveScreen('dashboard')} />;
      case 'add':
        return <AddSubscription onBack={() => setActiveScreen('dashboard')} onSuccess={() => setActiveScreen('dashboard')} />;
      case 'insights':
        return <Insights onBack={() => setActiveScreen('dashboard')} />;
      case 'settings':
        return <Settings onBack={() => setActiveScreen('dashboard')} />;
      case 'payments':
        return <PaymentMethods onBack={() => setActiveScreen('dashboard')} />;
      case 'notifications':
        return <Notifications />;
      case 'profile':
        return <Profile onLogout={handleLogout} />;
      case 'help':
        return <Help />;
      default:
        return <Dashboard onNavigate={setActiveScreen} />;
    }
  };
  
  return (
    <div className="min-h-screen bg-white dark:bg-[#0F0F1E] text-slate-900 dark:text-white">
      <Navigation activeScreen={activeScreen} onNavigate={setActiveScreen} />
      <div className="lg:ml-64 pb-24 lg:pb-0">
        {renderScreen()}
      </div>
    </div>
  );
}